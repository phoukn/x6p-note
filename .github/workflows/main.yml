name: 检查玩机笔记

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:  # 可以手动在 Actions 页面点 Run workflow 触发

jobs:
  check-and-cheer:
    runs-on: ubuntu-latest

    steps:
      - name: 下载仓库
        uses: actions/checkout@v4

      - name: 安装 shellcheck（检查 shell 脚本语法）
        run: sudo apt-get update && sudo apt-get install -y shellcheck

      - name: 检查 shell script backup 里的 .sh 文件
        run: |
          if ls "shell script backup"/*.sh >/dev/null 2>&1; then
            shellcheck "shell script backup"/*.sh || echo "有 shell 语法警告，但不影响继续玩机！"
          else
            echo "没找到 .sh 文件，跳过检查～"
          fi

      - name: 简单检查 host 文件（看有没有 localhost 重复或空行问题）
        run: |
          if [ -f "host" ]; then
            echo "检查 host 文件..."
            # 统计 localhost 出现次数（正常 hosts 里 localhost 只出现1-2次）
            localhost_count=$(grep -c "127.0.0.1.*localhost" host || true)
            if [ "$localhost_count" -gt 2 ]; then
              echo "警告：localhost 出现了 $localhost_count 次，可能有重复！"
            else
              echo "host 文件看起来正常（localhost 出现 $localhost_count 次）"
            fi
            # 检查空行或明显无效行（可选加严）
            empty_lines=\( (grep -c "^ \)" host || true)
            echo "有 $empty_lines 个空行（正常）"
          else
            echo "没找到 host 文件，跳过～"
          fi

      - name: 玩机鼓励！
        run: |
          echo "Root 稳了！继续玩机～ 😎"
          echo "LA 时间现在是 $(TZ=America/Los_Angeles date '+%Y-%m-%d %H:%M')"
          echo "今天的 hosts 和 shell 都检查过了，放心 push！🍔"
